<!-- Leyenda de daños reutilizable -->
<div class="mt-3 p-3 bg-light rounded">
  <h6 class="mb-3"><strong>Leyenda de Hallazgos Odontológicos (símbolos)</strong></h6>
  <div class="row g-2">
    <!-- Símbolos visuales (todos los dibujables) -->
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="1" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>1 -</strong> Caries (cuadro rojo)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="11" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>11 -</strong> Obturación (cuadro azul)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="2" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>2 -</strong> Corona Definitiva (círculo azul)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="3" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>3 -</strong> Corona Temporal (círculo rojo)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="4" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>4 -</strong> Diente Ausente (X azul)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="5" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>5 -</strong> Fractura (línea roja)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="8" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>8 -</strong> Diastema (dos arcos)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="9" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>9 -</strong> Diente Extruido (flecha afuera)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="10" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>10 -</strong> Diente en Clavija (triángulo)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="12" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>12 -</strong> Prótesis Removible (doble línea)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="13" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>13 -</strong> Migración (flecha)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="14" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>14 -</strong> Giroversión (semicírculo)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="15" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>15 -</strong> Fusión (elipse)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="16" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>16 -</strong> Rem. Radicular (RR)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="20" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>20 -</strong> Diente Intruido (flecha adentro)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="23" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>23 -</strong> Ortod. Removible (zig-zag)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="24" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>24 -</strong> Diente en Erupción (V + zig-zag)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="25" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>25 -</strong> Transposición Izq.</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="26" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>26 -</strong> Transposición Der.</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="27" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>27 -</strong> Supernumerario (S)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="28" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>28 -</strong> Pulpar (línea vertical)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="29" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>29 -</strong> Prótesis Total (doble línea)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="30" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>30 -</strong> Perno Muñón</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="31" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>31 -</strong> Edéntulo Total (línea)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="32" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>32 -</strong> Ortod. Fijo (extremo)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="33" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>33 -</strong> Ortod. Fijo (centro)</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="34" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>34 -</strong> Prótesis Fija Izq.</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="35" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>35 -</strong> Prótesis Fija Centro</small>
    </div>
    <div class="col-md-4 d-flex align-items-center">
      <canvas class="legend-icon" data-damage="36" width="30" height="30" style="border:1px solid #ddd; margin-right:8px;"></canvas>
      <small><strong>36 -</strong> Prótesis Fija Der.</small>
    </div>
  </div>
  <div class="mt-3 p-2 bg-white rounded border">
    <small class="text-muted">
      <strong>Referencias representadas con texto:</strong><br>
      • 6-IMP (Implante) | 17-MAC (Macrodoncia) | 18-MIC (Microdoncia) | 19-I (Impactación)<br>
      • 21-E (Diente Ectópico) | 22-DIS (Diente Discrómico) | 37-DES (Superficie Desgastada) | 38-SI (Semi-Impactación)
    </small>
  </div>
</div>

<!-- Script para dibujar iconos en la leyenda (self-contained) -->
<script defer>
  (function(){
    function drawLegendIcon(canvas, damageId) {
      const ctx = canvas.getContext('2d');
      const w = canvas.width;
      const h = canvas.height;
      const cx = w / 2;
      const cy = h / 2;

      ctx.clearRect(0, 0, w, h);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, w, h);

      switch (damageId) {
        case 1: // Caries - cuadro rojo
          ctx.fillStyle = '#FF0000';
          ctx.fillRect(cx - 8, cy - 8, 16, 16);
          break;
        case 2: // Corona definitiva - círculo azul
          ctx.strokeStyle = '#0000FF';
          ctx.lineWidth = 2;
          ctx.beginPath(); ctx.arc(cx, cy, 10, 0, Math.PI * 2); ctx.stroke();
          break;
        case 3: // Corona temporal - círculo rojo
          ctx.strokeStyle = '#FF0000';
          ctx.lineWidth = 2;
          ctx.beginPath(); ctx.arc(cx, cy, 10, 0, Math.PI * 2); ctx.stroke();
          break;
        case 4: // Diente ausente - X azul
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(5, 5); ctx.lineTo(w - 5, h - 5);
          ctx.moveTo(w - 5, 5); ctx.lineTo(5, h - 5);
          ctx.stroke();
          break;
        case 5: // Fractura - línea roja diagonal
          ctx.strokeStyle = '#FF0000'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(5, h - 5); ctx.lineTo(w - 5, 5); ctx.stroke();
          break;
        case 8: // Diastema - dos arcos
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2;
          ctx.beginPath(); ctx.arc(cx + 7, cy + 4, 6, Math.PI * 0.5, Math.PI * 1.5); ctx.stroke();
          ctx.beginPath(); ctx.arc(cx - 7, cy + 4, 6, Math.PI * 0.5, Math.PI * 1.5, true); ctx.stroke();
          break;
        case 9: // Diente Extruido - flecha afuera
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(cx, 6); ctx.lineTo(cx, 16);
          ctx.moveTo(cx - 6, 10); ctx.lineTo(cx, 4); ctx.lineTo(cx + 6, 10);
          ctx.stroke();
          break;
        case 10: // Diente en Clavija - triángulo
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(6, h - 6); ctx.lineTo(cx, 8); ctx.lineTo(w - 6, h - 6);
          ctx.closePath(); ctx.stroke();
          break;
        case 11: // Curación - cuadro azul
          ctx.fillStyle = '#0000FF'; ctx.fillRect(cx - 8, cy - 8, 16, 16);
          break;
        case 12: // Prótesis removible - doble línea
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(4, cy - 3); ctx.lineTo(w - 4, cy - 3);
          ctx.moveTo(4, cy + 3); ctx.lineTo(w - 4, cy + 3);
          ctx.stroke();
          break;
        case 13: // Migración - flecha
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(5, cy); ctx.lineTo(w - 5, cy); ctx.lineTo(w - 10, cy - 5);
          ctx.moveTo(w - 5, cy); ctx.lineTo(w - 10, cy + 5); ctx.stroke();
          break;
        case 14: // Giroversión - semicírculo + marca
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.arc(cx, cy, 8, Math.PI, Math.PI * 2); ctx.stroke();
          ctx.beginPath(); ctx.moveTo(cx + 8, cy); ctx.lineTo(cx + 3, cy);
          ctx.moveTo(cx + 8, cy); ctx.lineTo(cx + 8, cy - 5); ctx.stroke();
          break;
        case 15: // Fusión - elipse
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2;
          if (ctx.ellipse) { ctx.beginPath(); ctx.ellipse(cx, cy, 12, 6, 0, 0, Math.PI * 2); ctx.stroke(); }
          else { ctx.beginPath(); ctx.arc(cx, cy, 10, 0, Math.PI * 2); ctx.stroke(); }
          break;
        case 16: // Remanente radicular - RR
          ctx.fillStyle = '#FF0000'; ctx.font = 'bold 12px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
          ctx.fillText('RR', cx, cy);
          break;
        case 20: // Diente Intruido - flecha hacia adentro
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(cx, h - 6); ctx.lineTo(cx, h - 16);
          ctx.moveTo(cx - 6, h - 10); ctx.lineTo(cx, h - 4); ctx.lineTo(cx + 6, h - 10);
          ctx.stroke();
          break;
        case 23: // Ortod. Removible - zig-zag
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(4, cy); ctx.lineTo(cx, cy - 6); ctx.lineTo(w - 4, cy); ctx.stroke();
          break;
        case 24: // Diente en erupción - V + zig-zag
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(6, h - 10); ctx.lineTo(cx, h - 4); ctx.lineTo(w - 6, h - 10);
          ctx.moveTo(cx, h - 4); ctx.lineTo(cx, h - 10);
          ctx.lineTo(8, h - 16); ctx.lineTo(w - 8, h - 22); ctx.lineTo(8, h - 28);
          ctx.stroke();
          break;
        case 25: // Transposición Izq.
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          if (ctx.ellipse) { ctx.ellipse(cx + 6, 6, 12, 4, 0, Math.PI, Math.PI * 2); } else { ctx.moveTo(4, 10); ctx.lineTo(w - 4, 10); }
          ctx.stroke();
          ctx.beginPath(); ctx.moveTo(w - 6, 6); ctx.lineTo(w - 6, 2); ctx.moveTo(w - 6, 6); ctx.lineTo(w - 10, 6); ctx.stroke();
          break;
        case 26: // Transposición Der.
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          if (ctx.ellipse) { ctx.ellipse(cx - 6, 6, 12, 4, 0, Math.PI, Math.PI * 2); } else { ctx.moveTo(4, 10); ctx.lineTo(w - 4, 10); }
          ctx.stroke();
          ctx.beginPath(); ctx.moveTo(6, 6); ctx.lineTo(6, 2); ctx.moveTo(6, 6); ctx.lineTo(10, 6); ctx.stroke();
          break;
        case 27: // Supernumerario - S
          ctx.strokeStyle = '#0000FF'; ctx.fillStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.arc(cx, cy, 8, 0, Math.PI * 2); ctx.stroke();
          ctx.font = 'bold 12px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText('S', cx, cy);
          break;
        case 28: // Pulpar - línea vertical
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 3; ctx.beginPath();
          ctx.moveTo(cx, 5); ctx.lineTo(cx, h - 5); ctx.stroke();
          break;
        case 29: // Prótesis total - dos líneas
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(4, h - 8); ctx.lineTo(w - 4, h - 8);
          ctx.moveTo(4, h - 12); ctx.lineTo(w - 4, h - 12); ctx.stroke();
          break;
        case 30: // Perno muñón - cuadrado + línea
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.rect(cx - 6, cy - 6, 12, 12); ctx.moveTo(cx, cy + 6); ctx.lineTo(cx, h - 4); ctx.stroke();
          break;
        case 31: // Edéntulo total - línea
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 3; ctx.beginPath();
          ctx.moveTo(4, cy); ctx.lineTo(w - 4, cy); ctx.stroke();
          break;
        case 32: // Ortod. fijo (extremo)
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.rect(6, 6, w - 12, h - 12); ctx.moveTo(cx, 6); ctx.lineTo(cx, h - 6);
          ctx.moveTo(8, cy); ctx.lineTo(w - 8, cy); ctx.stroke();
          break;
        case 33: // Ortod. fijo (centro)
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(4, cy); ctx.lineTo(w - 4, cy); ctx.stroke();
          break;
        case 34: // Prótesis fija izq.
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(cx, 6); ctx.lineTo(cx, 14); ctx.lineTo(6, 14); ctx.stroke();
          break;
        case 35: // Prótesis fija centro
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(6, 14); ctx.lineTo(w - 6, 14); ctx.stroke();
          break;
        case 36: // Prótesis fija der.
          ctx.strokeStyle = '#0000FF'; ctx.lineWidth = 2; ctx.beginPath();
          ctx.moveTo(cx, 6); ctx.lineTo(cx, 14); ctx.lineTo(w - 6, 14); ctx.stroke();
          break;
      }
    }

    window.addEventListener('DOMContentLoaded', function(){
      document.querySelectorAll('.legend-icon').forEach(canvas => {
        const damageId = parseInt(canvas.getAttribute('data-damage'));
        drawLegendIcon(canvas, damageId);
      });
    });
  })();
</script>
